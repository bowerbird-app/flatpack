<!DOCTYPE html>
<html class="h-full overflow-hidden overscroll-none">
  <head>
    <title>FlatPack Demo</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
  </head>

  <body class="m-0 h-full overflow-hidden overscroll-none" data-controller="dark-mode">
    <%= render "layouts/icon_sprite" %>

    <% sidebar_side = params[:side].in?(%w[left right]) ? params[:side].to_sym : :left %>
    <%= render FlatPack::SidebarLayout::Component.new(
      side: sidebar_side,
      storage_key: "flatpack-dummy-shell"
    ) do |layout| %>
      <% layout.sidebar do %>
        <%= render FlatPack::Sidebar::Component.new(side: sidebar_side) do |sidebar| %>
          <% sidebar.header do %>
            <%= render FlatPack::Sidebar::Header::Component.new(
              brand_abbr: "FP",
              title: "FlatPack",
              subtitle: "Dummy App"
            ) %>
          <% end %>

          <% sidebar.items do %>
            <nav class="py-4 space-y-1" aria-label="Main navigation">
              <%= render FlatPack::Sidebar::Item::Component.new(
                label: "Overview",
                href: demo_path,
                icon: :home,
                active: current_page?(demo_path)
              ) %>
              <%= render FlatPack::Sidebar::Item::Component.new(
                label: "Themes",
                href: themes_path,
                icon: :palette,
                active: current_page?(themes_path)
              ) %>
              
              <%= render FlatPack::Sidebar::Divider::Component.new %>
              
              <!-- Interactive Components -->
              <%= render FlatPack::Sidebar::Item::Component.new(
                label: "Buttons",
                href: demo_buttons_path,
                icon: :square,
                active: current_page?(demo_buttons_path)
              ) %>
              <%= render FlatPack::Sidebar::Item::Component.new(
                label: "Modals",
                href: demo_modals_path,
                icon: :box,
                active: current_page?(demo_modals_path)
              ) %>
              <%= render FlatPack::Sidebar::Item::Component.new(
                label: "Popovers",
                href: demo_popovers_path,
                icon: :question,
                active: current_page?(demo_popovers_path)
              ) %>
              <%= render FlatPack::Sidebar::Item::Component.new(
                label: "Tooltips",
                href: demo_tooltips_path,
                icon: :question,
                active: current_page?(demo_tooltips_path)
              ) %>
              <%= render FlatPack::Sidebar::Item::Component.new(
                label: "Tabs",
                href: demo_tabs_path,
                icon: :folder,
                active: current_page?(demo_tabs_path)
              ) %>
              <%= render FlatPack::Sidebar::Item::Component.new(
                label: "Toasts",
                href: demo_toasts_path,
                icon: :bell,
                active: current_page?(demo_toasts_path)
              ) %>
              <%= render FlatPack::Sidebar::Item::Component.new(
                label: "Collapse",
                href: demo_collapse_path,
                icon: :chevron_down,
                active: current_page?(demo_collapse_path)
              ) %>
              
              <%= render FlatPack::Sidebar::Divider::Component.new %>
              
              <!-- Form Components -->
              <%= render FlatPack::Sidebar::Item::Component.new(
                label: "Forms",
                href: demo_forms_path,
                icon: :edit_3,
                active: current_page?(demo_forms_path)
              ) %>
              <%= render FlatPack::Sidebar::Item::Component.new(
                label: "Inputs",
                href: demo_inputs_path,
                icon: :type,
                active: current_page?(demo_inputs_path)
              ) %>
              <%= render FlatPack::Sidebar::Item::Component.new(
                label: "Range Input",
                href: demo_range_input_path,
                icon: :settings,
                active: current_page?(demo_range_input_path)
              ) %>
              
              <%= render FlatPack::Sidebar::Divider::Component.new %>
              
              <!-- Data Display -->
              <%= render FlatPack::Sidebar::Item::Component.new(
                label: "Tables",
                href: demo_tables_path,
                icon: :table,
                active: current_page?(demo_tables_path)
              ) %>
              <%= render FlatPack::Sidebar::Item::Component.new(
                label: "Pagination",
                href: demo_pagination_path,
                icon: :chevron_right,
                active: current_page?(demo_pagination_path)
              ) %>
              <%= render FlatPack::Sidebar::Item::Component.new(
                label: "Infinite Scroll",
                href: demo_pagination_infinite_path,
                icon: :chevron_down,
                active: current_page?(demo_pagination_infinite_path)
              ) %>
              <%= render FlatPack::Sidebar::Item::Component.new(
                label: "Charts",
                href: demo_charts_path,
                icon: :dashboard,
                active: current_page?(demo_charts_path)
              ) %>
              <%= render FlatPack::Sidebar::Item::Component.new(
                label: "Grid",
                href: demo_grid_path,
                icon: :dashboard,
                active: current_page?(demo_grid_path)
              ) %>
              <%= render FlatPack::Sidebar::Item::Component.new(
                label: "Code Blocks",
                href: demo_code_blocks_path,
                icon: :type,
                active: current_page?(demo_code_blocks_path)
              ) %>
              <%= render FlatPack::Sidebar::Item::Component.new(
                label: "Avatars",
                href: demo_avatars_path,
                icon: :user,
                active: current_page?(demo_avatars_path)
              ) %>
              <%= render FlatPack::Sidebar::Item::Component.new(
                label: "Comments",
                href: demo_comments_path,
                icon: :users,
                active: current_page?(demo_comments_path)
              ) %>
              <%= render FlatPack::Sidebar::Item::Component.new(
                label: "Chat",
                href: demo_chat_path,
                icon: :message_circle,
                active: current_page?(demo_chat_path) || current_page?(demo_chat_basic_path) || current_page?(demo_chat_states_path)
              ) %>
              <%= render FlatPack::Sidebar::Item::Component.new(
                label: "Progress",
                href: demo_progress_path,
                icon: :dashboard,
                active: current_page?(demo_progress_path)
              ) %>
              <%= render FlatPack::Sidebar::Item::Component.new(
                label: "Skeletons",
                href: demo_skeletons_path,
                icon: :square,
                active: current_page?(demo_skeletons_path)
              ) %>
              <%= render FlatPack::Sidebar::Item::Component.new(
                label: "List",
                href: demo_list_path,
                icon: :align_left,
                active: current_page?(demo_list_path)
              ) %>
              <%= render FlatPack::Sidebar::Item::Component.new(
                label: "Timeline",
                href: demo_timeline_path,
                icon: :calendar,
                active: current_page?(demo_timeline_path)
              ) %>
              
              <%= render FlatPack::Sidebar::Divider::Component.new %>
              
              <!-- Layout Components -->
              <%= render FlatPack::Sidebar::Item::Component.new(
                label: "Cards",
                href: demo_cards_path,
                icon: :box,
                active: current_page?(demo_cards_path)
              ) %>
              <%= render FlatPack::Sidebar::Item::Component.new(
                label: "Page Title",
                href: demo_page_header_path,
                icon: :align_left,
                active: current_page?(demo_page_header_path)
              ) %>
              <%= render FlatPack::Sidebar::Item::Component.new(
                label: "Empty State",
                href: demo_empty_state_path,
                icon: :folder,
                active: current_page?(demo_empty_state_path)
              ) %>
              
              <%= render FlatPack::Sidebar::Divider::Component.new %>
              
              <!-- Feedback Components -->
              <%= render FlatPack::Sidebar::Item::Component.new(
                label: "Alerts",
                href: demo_alerts_path,
                icon: :alert,
                active: current_page?(demo_alerts_path)
              ) %>
              <%= render FlatPack::Sidebar::Item::Component.new(
                label: "Badges",
                href: demo_badges_path,
                icon: :dashboard,
                active: current_page?(demo_badges_path)
              ) %>
              <%= render FlatPack::Sidebar::Item::Component.new(
                label: "Chips",
                href: demo_chips_path,
                icon: :dashboard,
                active: current_page?(demo_chips_path)
              ) %>
              
              <%= render FlatPack::Sidebar::Divider::Component.new %>
              
              <!-- Navigation Components -->
              <%= render FlatPack::Sidebar::Item::Component.new(
                label: "Breadcrumbs",
                href: demo_breadcrumbs_path,
                icon: :chevron_right,
                active: current_page?(demo_breadcrumbs_path)
              ) %>
              <%= render FlatPack::Sidebar::Item::Component.new(
                label: "Top Nav",
                href: demo_navbar_path,
                icon: :monitor,
                active: current_page?(demo_navbar_path)
              ) %>
              <%= render FlatPack::Sidebar::Item::Component.new(
                label: "Search",
                href: demo_search_path,
                icon: :search,
                active: current_page?(demo_search_path)
              ) %>
              <%= render FlatPack::Sidebar::Item::Component.new(
                label: "Sidebar",
                href: demo_sidebar_layout_path,
                icon: :laptop,
                active: current_page?(demo_sidebar_layout_path)
              ) %>
              <%= render FlatPack::Sidebar::Item::Component.new(
                label: "Mobile",
                href: mobile_bottom_nav_path,
                icon: :menu,
                active: current_page?(mobile_path) || current_page?(mobile_bottom_nav_path)
              ) %>
            </nav>
          <% end %>

          <% sidebar.footer do %>
            <%= render FlatPack::Sidebar::Footer::Component.new(class: "text-sm text-muted-foreground") do %>
              FlatPack Demo Components
            <% end %>
          <% end %>

        <% end %>
      <% end %>

      <% layout.top_nav do %>
        <%= render FlatPack::TopNav::Component.new do |nav| %>
          <% nav.left do %>
            <button
              type="button"
              class="md:hidden p-2 rounded-lg hover:bg-muted transition-colors"
              data-flat-pack--sidebar-layout-target="mobileToggle"
              data-action="click->flat-pack--sidebar-layout#toggleMobile"
              aria-label="Toggle sidebar"
            >
              <%= render FlatPack::Shared::IconComponent.new(name: :menu, size: :md) %>
            </button>
            <span class="text-sm font-medium text-muted-foreground">FlatPack Demo</span>
          <% end %>

          <% nav.center do %><% end %>

          <% nav.right do %>
            <div class="ml-auto flex items-center gap-3" data-controller="flat-pack--theme">
              <!-- Theme Switcher -->
              <div class="relative group" data-controller="flat-pack--button-dropdown">
                <button
                  type="button"
                  class="p-2 rounded-lg hover:bg-muted transition-colors"
                  aria-label="Theme switcher"
                  data-action="click->flat-pack--button-dropdown#toggle"
                  data-flat-pack--button-dropdown-target="trigger"
                >
                  <%= render FlatPack::Shared::IconComponent.new(name: :circle, size: :md) %>
                </button>
                <div 
                  class="hidden absolute right-0 mt-2 w-48 bg-background border border-border rounded-lg shadow-lg py-1 z-50"
                  data-flat-pack--button-dropdown-target="menu"
                >
                  <button
                    type="button"
                    class="w-full px-4 py-2 text-left text-sm hover:bg-muted transition-colors"
                    data-action="click->flat-pack--theme#switch click->flat-pack--button-dropdown#toggle"
                    data-theme-value="system"
                  >
                    System
                  </button>
                  <button
                    type="button"
                    class="w-full px-4 py-2 text-left text-sm hover:bg-muted transition-colors"
                    data-action="click->flat-pack--theme#switch click->flat-pack--button-dropdown#toggle"
                    data-theme-value="light"
                  >
                    Light
                  </button>
                  <button
                    type="button"
                    class="w-full px-4 py-2 text-left text-sm hover:bg-muted transition-colors"
                    data-action="click->flat-pack--theme#switch click->flat-pack--button-dropdown#toggle"
                    data-theme-value="dark"
                  >
                    Dark
                  </button>
                  <button
                    type="button"
                    class="w-full px-4 py-2 text-left text-sm hover:bg-muted transition-colors"
                    data-action="click->flat-pack--theme#switch click->flat-pack--button-dropdown#toggle"
                    data-theme-value="ocean"
                  >
                    Ocean
                  </button>
                </div>
              </div>

              <%= render FlatPack::Switch::Component.new(
                name: "dark_mode",
                label: "Dark mode",
                data: {
                  dark_mode_target: "toggle",
                  action: "change->dark-mode#toggle"
                },
                aria: { label: "Toggle dark mode" }
              ) %>

            <%= render FlatPack::Button::Component.new(
              icon: "bell",
              icon_only: true,
              style: :ghost,
              size: :sm,
              aria: { label: "Notifications" }
            ) %>
            </div>
          <% end %>

        <% end %>
      <% end %>

      <% layout.main do %>
        <main class="p-8">
          <div class="max-w-4xl mx-auto pb-24">
            <% if notice.present? %>
              <div class="mb-4 rounded-lg border border-border bg-muted px-4 py-3 text-sm">
                <%= notice %>
              </div>
            <% end %>

            <%= yield %>

          </div>
        </main>
      <% end %>
    <% end %>
  </body>
</html>
