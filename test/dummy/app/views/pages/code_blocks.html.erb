<%= render FlatPack::PageTitle::Component.new(
  title: "Code Block Component",
  subtitle: "Reusable code snippets for demos and documentation pages."
) %>

<%
  erb_output_open = "<" + "%="
  erb_tag_close = "%" + ">"

  component_docs = [
    {
      collapse_id: "components-code-block",
      title: "Code Block",
      method_call: <<~CODE,
        #{erb_output_open} render FlatPack::CodeBlock::Component.new(
          title: "ERB",
          language: "erb",
            code: "#{erb_output_open} render FlatPack::Button::Component.new(text: \"Primary\", style: :primary) #{erb_tag_close}"
        ) #{erb_tag_close}
      CODE
      variables: [
        { variable: "code", accepts: "String (required unless snippets are provided)" },
        { variable: "snippets", accepts: "Array of hashes: [{ label:, code:, language: }]" },
        { variable: "language", accepts: "String or nil" },
        { variable: "title", accepts: "String or nil" },
        { variable: "separated", accepts: "true, false" }
      ]
    }
  ]
%>

<section class="mb-12">
  <%= render FlatPack::SectionTitle::Component.new(
    title: "Components",
    subtitle: "The component demoed on this page is listed below.",
    anchor_link: true,
    anchor_id: "component-method-variables"
  ) %>

  <div class="space-y-4">
    <% component_docs.each do |component_doc| %>
      <%= render FlatPack::Collapse::Component.new(id: component_doc[:collapse_id], title: component_doc[:title]) do %>
        <%= render FlatPack::CodeBlock::Component.new(
          title: "Method Call",
          language: "erb",
          code: CGI.unescapeHTML(component_doc[:method_call]),
          class: "mb-4"
        ) %>

        <%= render FlatPack::Table::Component.new(data: component_doc[:variables]) do |table| %>
          <% table.column(title: "Variable", html: ->(row) { row[:variable] }) %>
          <% table.column(title: "Accepts", html: ->(row) { row[:accepts] }) %>
        <% end %>
      <% end %>
    <% end %>
  </div>
</section>

<!-- Basic Usage -->
<section class="mb-12">
  <%= render FlatPack::SectionTitle::Component.new(title: "Basic Usage", anchor_link: true, subtitle: "Examples for Basic Usage.") %>
  <%= render FlatPack::CodeBlock::Component.new(
    code: CGI.unescapeHTML(<<~'CODE')
      #{erb_output_open} render FlatPack::Button::Component.new(
        text: "Primary",
        style: :primary
      ) #{erb_tag_close}
    CODE
  ) %>
</section>

<!-- With Title -->
<section class="mb-12">
  <%= render FlatPack::SectionTitle::Component.new(title: "With Title", anchor_link: true, subtitle: "Examples for With Title.") %>
  <%= render FlatPack::CodeBlock::Component.new(
    title: "Ruby",
    code: <<~CODE
      @users = User.order(created_at: :desc).limit(10)
    CODE
  ) %>
</section>

<!-- With Language -->
<section class="mb-12">
  <%= render FlatPack::SectionTitle::Component.new(title: "With Language Class", anchor_link: true, subtitle: "Examples for With Language Class.") %>
  <p class="text-[var(--color-muted-foreground)] mb-4">
    Adds a language class to the <code>&lt;code&gt;</code> element (for optional syntax highlighters).
  </p>

  <%= render FlatPack::CodeBlock::Component.new(
    title: "JavaScript",
    language: "javascript",
    code: <<~CODE
      document.addEventListener("turbo:load", () => {
        console.log("FlatPack demo ready")
      })
    CODE
  ) %>
</section>

<!-- Real Demo Pattern -->
<section class="mb-12">
  <%= render FlatPack::SectionTitle::Component.new(title: "Real Demo Pattern", anchor_link: true, subtitle: "Examples for Real Demo Pattern.") %>
  <p class="text-[var(--color-muted-foreground)] mb-4">
    Use this component where demos currently render raw <code>&lt;pre&gt;&lt;code&gt;</code> blocks.
  </p>

  <%= render FlatPack::CodeBlock::Component.new(
    title: "ERB",
    language: "erb",
    code: <<~CODE
      #{erb_output_open} render FlatPack::Badge::Component.new(text: "New", style: :primary) #{erb_tag_close}
    CODE
  ) %>
</section>

<!-- Multiple Snippets -->
<section class="mb-12">
  <%= render FlatPack::SectionTitle::Component.new(title: "Multiple Snippets", anchor_link: true, subtitle: "Examples for Multiple Snippets.") %>
  <p class="text-[var(--color-muted-foreground)] mb-4">
    Pass an array of snippets to render code pills inside the code block.
  </p>

  <%= render FlatPack::CodeBlock::Component.new(
    title: "Button Variants",
    snippets: [
      {
        label: "Primary",
        language: "erb",
        code: "#{erb_output_open} render FlatPack::Button::Component.new(text: \"Primary\", style: :primary) #{erb_tag_close}"
      },
      {
        label: "Secondary",
        language: "erb",
        code: "#{erb_output_open} render FlatPack::Button::Component.new(text: \"Secondary\", style: :secondary) #{erb_tag_close}"
      },
      {
        label: "Ghost",
        language: "erb",
        code: "#{erb_output_open} render FlatPack::Button::Component.new(text: \"Ghost\", style: :ghost) #{erb_tag_close}"
      },
      {
        label: "Loading",
        language: "erb",
        code: "#{erb_output_open} render FlatPack::Button::Component.new(text: \"Loading\", style: :primary, loading: true) #{erb_tag_close}"
      }
    ]
  ) %>
</section>